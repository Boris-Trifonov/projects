# Восстановление золота из руды
# Цель исследования:
- Подготовить прототип модели машинного обучения, для оптимизации производства, чтобы не запускать предприятие с убыточными характеристиками.

# Задачи:
- Проверить формулу вычисления эффективности обогащения
- Проанализировать признаки, недоступные в тестовой выборке
- Проанализировать распределения размеров гранул на обучающей и тестовой выборках
- Исследовать суммарные концентрации
- Обучить и проверить несколько моделей
- Выбрать лучшую модель, и проверить ее качество на тестовой выборке

# Условия задачи:
- Написать функцию для вычисления итогового sMAPE. Нужно спрогнозировать сразу две величины:
  - эффективность обогащения чернового концентрата rougher.output.recovery;
  - эффективность обогащения финального концентрата final.output.recovery.
- Итоговая метрика складывается из двух величин: 25% * sMAPE(rougher) + 75% * sMAPE(final)
- Данные индексируются датой и временем получения информации (признак date). Соседние по времени параметры часто похожи.
- В нашем распоряжении сырые данные: их просто выгрузили из хранилища.
- Модель должна предсказать коэффициент восстановления золота из золотосодержащей руды.
- Необходимо использовать данные с параметрами добычи и очистки.
- Эффективность обогащения рассчитывается по формуле:
  `Recovery = C(F-T) / F(C-T) * 100%`
  C — доля золота в концентрате после флотации/очистки;
  F — доля золота в сырье/концентрате до флотации/очистки;
  T — доля золота в отвальных хвостах после флотации/очистки.
**sMAPE = (1/n) * Σ(|прогноз – фактический| / ((|прогноз| + |фактический|)/2) * 100%**

# Используемые библиотеки:
pandas, seaborn, Matplotlib, numpy, sklearn.

# Основные выводы:
- Подготовили данные:
    - Обработаны пропуски
    - Проверена формула вычисления эффективности обогащения
    - Проанализированы признаки, недоступные в тестовой выборке. Добавили 2 целевых признака `rougher.output.recovery` и `final.output.recovery`, остальные могут негативно сказаться на модели.
    - Сделан вывод о необходимости масштабирования признаков перед обучением.
    
- Проанализировали зменение концентрации металлов (Au, Ag, Pb) на различных этапах очистки:
    - Концентрация золота на каждом этапе заметно увеличивается
    - Концентрация серебра на этапе флотации увеличивается, затем начинает снижаться, на дальнейших этапах. Серебро на этапе флотации, обогащается, как и золото.
    - После этапа флотации, концентрация свинца увеличивается. На дальнейших этапах изменения незначительны.
    - Концентрация остальных примесей на каждом этапе заметно снижается, т.к. в этом и заключается цель технологического процесса - увеличить концентрацию драгоценных металлов
    - Сразу избавились от аномальных нулевых значений на всех технологических этапах.

- Произведено сравнение распределения размеров гранул сырья:
    - На стадии флотации распределение размеров гранул похожи, но в тестовой выборке, преобладают гранулы размером чуть меньше 50(предположительно, мм), а в обучающей выборке - немного больше 50 мм. Будем считать эти отличия незначительными.
    - На стадии первичной очистки распределение размеров гранул на стадии первичной очистки практически, не отличаются. После флотации размер гранул значительно снижается.

- Изучили суммарную концентрацию всех веществ на разных стадиях:
    - После флотации концентрация всех веществ увеличивается, но диапазон распределения не меняется - происходит обогащение руды. На финальном этапе - концентрация уменьшается,а диапазон распределения уменьшается.
    
- Подготовили данные перед обучением:
    - Произвели стандартизацию признаков.
    - Подготовили функции для расчета значения sMAPE и итогового sMAPE.
    - Написали функцию для проверки качества модели кросс-валидацией.
    
- Обучение:
    - Рассмотрели модели: DecisionTreeRegressor, RandomForestRegressor и LinearRegression. Оценили их качество кросс-валидацией.
    - Наилучший результат показала модель RandomForestRegressor с гиперпараметрами: max_depth=4, n_estimators=30 для чернового концентрата и max_depth=4, n_estimators=40 для финального концентрата. Итоговый sMAPE = 8.42
    - Модель проверена на адекватность, с помощью DummyRegressor. sMAPE случайной модели = 9.8, что значительно вышее выбранной нами модели.
    - Модель RandomForestRegressor проверена на тестовой выборке. Итоговый sMAPE = 9.20

- В ИТОГЕ: Подготовлен прототип модели машинного обучения, который должен помочь оптимизировать производство, чтобы не запускать предприятие с убыточными характеристиками.
